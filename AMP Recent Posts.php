<?php/* * Plugin Name: AMP Recent Posts * Version: 3.1.1 * Plugin URI: https://jaaadesign.nl/en/amp-recent-posts/ * Description: Adds recent posts (linking to AMP) to your AMP content. Extends the AMP plugin (Automattic) via options page, works alongside all other AMP plugins by use of shortcode added to the plugins template. * Author: Nick van de Veerdonk * Author URI: https://jaaadesign.nl/ */  // create custom plugin settings menuadd_action('admin_menu', 'amp_recent_posts_menu');function amp_recent_posts_menu() {	//create new top-level menu	add_menu_page('AMP Recent Posts Settings', 'AMP Recent Posts', 'administrator', __FILE__, 'amp_recent_posts_options_page' , plugins_url('/images/icon.png', __FILE__), 102 );	//call register settings function	add_action( 'admin_init', 'register_amp_recent_posts_settings' );}function register_amp_recent_posts_settings() {	//register our settings	register_setting( 'amp_recent_posts_group', 'use_hook' );		register_setting( 'amp_recent_posts_group', 'set_prio_hook_amp' );		register_setting( 'amp_recent_posts_group', 'append_amp' );	register_setting( 'amp_recent_posts_group', 'heading_amp' );	register_setting( 'amp_recent_posts_group', 'max_amp' );	register_setting( 'amp_recent_posts_group', 'type_check_post_amp' );		register_setting( 'amp_recent_posts_group', 'cust_post_supp_amp' );		register_setting( 'amp_recent_posts_group', 'exclude_any_id_amp_1' );		register_setting( 'amp_recent_posts_group', 'exclude_any_id_amp_2' );		register_setting( 'amp_recent_posts_group', 'exclude_any_id_amp_3' );		register_setting( 'amp_recent_posts_group', 'exclude_any_id_amp_4' );		register_setting( 'amp_recent_posts_group', 'exclude_any_id_amp_5' );	    register_setting( 'amp_recent_posts_group', 'sel_thumb_amp' );    register_setting( 'amp_recent_posts_group', 'sel_date_amp' );	}function amp_recent_posts_options_page() { 	   	?><div class="wrap"><h1><span class="dashicons dashicons-admin-settings" style="font-size: 35px;    color: #4665A7;    padding-right: 20px;"></span>AMP Recent Posts</h1><table width="100%"><br /><br />	<tbody><tr>    	<td valign="top">            <table class="wp-list-table widefat fixed ">                <thead>                    <tr>                        <th>AMP Recent Posts Settings</th>                    </tr>                </thead>                <tbody>                <tr>                    <td>                                             <form method="post" action="options.php">    <?php settings_fields( 'amp_recent_posts_group' ); ?>    <?php do_settings_sections( 'amp_recent_posts_group' ); ?>		    <table class="form-table"><br />	 <p><strong>NB.</strong> If you are NOT using the Automattic AMP plugin please implement the recent posts by adding this code to your plugins templates:</p><blockquote><strong>&lt;?php echo do_shortcode( "[amp-recent-posts append='amp' heading='Recent Posts' max='5']" ); ?&gt;</strong></blockquote>	    <tr valign="top">        <th scope="row">Use AMP plugin (Automattic) hook?</th>		<td><input name="use_hook" type="checkbox" value="1" <?php checked( '1', get_option( 'use_hook' ) ); ?> />		<br />		<p>This will implement the recent posts without the use of shortcode.</p></td>        </tr>			<tr valign="top">        <th scope="row">Priority of hook		<td><input type="number" name="set_prio_hook_amp" size="5" id="myHookprioamp" value="<?php echo esc_attr( get_option('set_prio_hook_amp') ); ?>" />		<br />		<p>We suggest you set this to <strong>3</strong>, to play nice with our other plugins, if you wish to move the recent posts up of down change this number. </p>		</td>		</tr>				        <tr valign="top">        <th scope="row">Set endpoint*</th>        <td><input type="text" name="append_amp" id="myAmpend" value="<?php echo esc_attr( get_option('append_amp') ); ?>" />		<br />		<p>Unless you have changed this the AMP plugin uses '<strong>amp</strong>', just letters no apostrophes. The endpoint is the last part of the URL to indicate AMP content. </p></td>        </tr>                 <tr valign="top">        <th scope="row">Heading</th>        <td><input type="text" name="heading_amp" id="myDefhead" value="<?php echo esc_attr( get_option('heading_amp') ); ?>" />		<br />		<p>Add an &lt;H3&gt; heading here.</p></td>		</tr>		<br />  				<tr valign="top">        <th scope="row">Set number of posts*</th>		<td><input type="number" name="max_amp" size="5" id="myNumberofposts" value="<?php echo esc_attr( get_option('max_amp') ); ?>" />		<br />		<p>The maximum of recent posts rendered, for example <strong>5</strong>.</p>		</td>		</tr>			  	        <tr valign="top">        <th scope="row">Return posts?</th>		<td><input name="type_check_post_amp" type="checkbox" id="mySetpostsdef" value="post" <?php checked( 'post', get_option( 'type_check_post_amp' ) ); ?>" />		<br />		<p>Check this to show recent posts, as opposed to -for example- 'pages'.</p></td>        </tr>					        <tr valign="top">        <th scope="row">Other post types</th>		<td><input type="text" name="cust_post_supp_amp" value="<?php echo esc_attr( get_option('cust_post_supp_amp') ); ?>" />								<br />		<p>If you wish to return a different post type set it here. (ex.: post, page, product, portfolio).</p>		</td>		</tr>         		                <tr valign="top">        <th scope="row">Display featured image?</th>		<td><input name="sel_thumb_amp" type="checkbox" value="1" <?php checked( '1', get_option( 'sel_thumb_amp' ) ); ?>" />		<br />		<p>Check this to show featured images.</p></td>        </tr>			              <tr valign="top">        <th scope="row">Show date?</th>		<td><input name="sel_date_amp" type="checkbox" value="1" <?php checked( '1', get_option( 'sel_date_amp' ) ); ?>" />		<br />		<p>Check this to show the dates.</p></td>        </tr>						<tr valign="top">        <th scope="row">Exclude posts by ID</th>		<td> <input type="text" name="exclude_any_id_amp_1" size="5" value="<?php echo esc_attr( get_option('exclude_any_id_amp_1') ); ?>" /> 		 <input type="text" name="exclude_any_id_amp_2" size="5" value="<?php echo esc_attr( get_option('exclude_any_id_amp_2') ); ?>" />	 		 <input type="text" name="exclude_any_id_amp_3" size="5" value="<?php echo esc_attr( get_option('exclude_any_id_amp_3') ); ?>" />	 		 <input type="text" name="exclude_any_id_amp_4" size="5" value="<?php echo esc_attr( get_option('exclude_any_id_amp_4') ); ?>" />	 		 <input type="text" name="exclude_any_id_amp_5" size="5" value="<?php echo esc_attr( get_option('exclude_any_id_amp_5') ); ?>" />			<br />		<p>Some posts are more equal than others, you can find their ID in the admin URL of the post, page etc.</p>		 		</td>	 		</tr>		    </table>       <br />  <br />    <?php submit_button(); ?></form>                    							                         <br>                                                <span style="font-size: 1.4rem;color: #ffe200;">★★★★★</span> If you like this plugin please consider <a href="https://nl.wordpress.org/plugins/amp-recent-posts/" target="_blank">rating it</a>, thank you!                        <br><br>                   	</td>                                    </tr>                </tbody>            </table>            <br>		</td>				        <td width="15">&nbsp;</td>        <td width="250" valign="top">				            <table class="wp-list-table widefat fixed bookmarks">            	                <tbody>                <tr>                	<td style="padding:4px;">                    	 						<a href="https://nl.wordpress.org/plugins/amp-recent-posts/" title="Visit Wordpress plugin page" target="_blank">						<img width="240" alt="AMP Recent Posts" src="<?php echo plugin_dir_url( __FILE__ ) . 'images/admin-logo.jpg'; ?>" class="aligncenter"></a>                    </td>                </tr>                </tbody>            </table>            <br>		        	            <table class="wp-list-table widefat fixed bookmarks">            	<thead>                <tr>									<th>Our other plugins</th>                </tr>                </thead>                               <tbody>                <tr>                	<td>                    <ul class="uaf_list">                    	<li><a href="https://wordpress.org/plugins/amp-social-share/" target="_blank">AMP Social Share</a></li>						<li><a href="https://wordpress.org/plugins/amp-html-sitemap/" target="_blank">AMP HTML Sitemap</a></li>                        <li><a href="https://wordpress.org/plugins/amp-related-posts/" target="_blank">AMP Related Posts</a></li>                        <li><a href="https://wordpress.org/plugins/amp-recent-posts-widget/" target="_blank">AMP Recent Posts widget</a></li>                                          </ul>                    </td>                </tr>                </tbody>            </table>            <br>						<table class="wp-list-table widefat fixed bookmarks">            	<thead>                <tr>                											<th>Articles</th>                </tr>                </thead>                               <tbody>                <tr>                	<td>                    <ul class="uaf_list">                    	<li><a href="https://jaaadesign.nl/en/blog/wpml-language-switcher-amp/" target="_blank">WPML language switcher in AMP</a></li>                        <li><a href="https://jaaadesign.nl/en/blog/wordpress-amp/" target="_blank">WordPress AMP tutorial</a></li>                        <li><a href="https://jaaadesign.nl/en/blog/what-is-structured-data/" target="_blank">What is Structured Data?</a></li>                        <li><a href="https://jaaadesign.nl/en/blog/structured-data-examples/" target="_blank">Structured Data examples, tools and generators</a></li>                    </ul>                    </td>                </tr>                </tbody>            </table>            <br>			        <table class="wp-list-table widefat fixed bookmarks">            	<thead>                <tr>                											<th>Keep in touch</th>                </tr>                </thead>                               <tbody>                <tr>                	<td>                    <ul class="uaf_list">                        <li><a href="https://jaaadesign.nl/en/contact/" target="_blank">Contact Us</a></li>                    </ul>                    </td>                </tr>                </tbody>            </table>            <br>                             </td>    </tr></tbody></table></div><?php } //* Global $priohook = get_option( 'set_prio_hook_amp' );add_action('amp_post_template_footer', 'amp_recent_function_global', $priohook);function amp_recent_function_global() {	if ( function_exists('is_amp_endpoint') && get_option( 'use_hook' ) == '1' && is_single() && !is_page() ) {		$numm1 = get_option( 'exclude_any_id_amp_1' );$numm2 = get_option( 'exclude_any_id_amp_2' );$numm3 = get_option( 'exclude_any_id_amp_3' );$numm4 = get_option( 'exclude_any_id_amp_4' );$numm5 = get_option( 'exclude_any_id_amp_5' );$type1 = get_option( 'type_check_post_amp' );$type2 = get_option( 'cust_post_supp_amp' );$maxamp = get_option( 'max_amp' );   // WP_Query arguments$args = array (	'post_type'              => array( $type1, $type2 ),	'order'                  => 'DESC',	'orderby'                => 'date',	'showposts' 			 => $maxamp, 	'post__not_in'			 => array (get_the_ID(), $numm1, $numm2, $numm3, $numm4, $numm5 ),	'post_status'            => 'publish',		 ); $attappendamp = get_option( 'append_amp' );$attheadingamp = get_option( 'heading_amp' );$ampthumb = get_the_post_thumbnail( 'thumbnail' );echo '<div class="jd-css-plugins-arp">';echo '<div class="jd-css-plugins-cont">';echo '<div class="jd-css-plugins-inner">';echo '<h3>'.$attheadingamp.'</h3>';echo '<ul>';// The Query$query = new WP_Query( $args );// The Loopif ( $query->have_posts() ) {	while ( $query->have_posts() ) {		$query->the_post();		// do something$ampthumb = get_the_post_thumbnail_url();$ampthumbalt = get_the_title(); $ampdefimg = plugin_dir_url( __FILE__ ) . 'images/default-thumb.jpg';$ampdate = get_the_date();// Featured image + has thumb + date	if ( get_option( 'sel_thumb_amp' ) == '1' && has_post_thumbnail() && get_option( 'sel_date_amp' ) == '1') {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="ampimgcont"><amp-img src="'. $ampthumb .'" alt="'. $ampthumbalt .'" height="70" width="70"></amp-img></div><div class="amplinkcont">'.get_the_title().'</a><p>'. $ampdate .'</p></div></li>';	 } // Featured image + has thumb  	else if ( get_option( 'sel_thumb_amp' ) == '1' && has_post_thumbnail() && !get_option( 'sel_date_amp' ) == '1') {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="ampimgcont"><amp-img src="'. $ampthumb .'" alt="'. $ampthumbalt .'" height="70" width="70"></amp-img></div><div class="amplinkcont">'.get_the_title().'</a></div></li>';	 } // Featured image + NO thumb + date  else if ( get_option( 'sel_thumb_amp' ) == '1' && !has_post_thumbnail() && get_option( 'sel_date_amp' ) == '1') {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="ampimgcont"><amp-img src="'. $ampdefimg .'" alt="'. $ampthumbalt .'" height="70" width="70"></amp-img></div><div class="amplinkcont">'.get_the_title().'</a><p>'. $ampdate .'</p></div></li>';	 }   // Featured image + NO thumb + NO date else if ( get_option( 'sel_thumb_amp' ) == '1' && !has_post_thumbnail() && !get_option( 'sel_date_amp' ) == '1') {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="ampimgcont"><amp-img src="'. $ampdefimg .'" alt="'. $ampthumbalt .'" height="70" width="70"></amp-img></div><div class="amplinkcont">'.get_the_title().'</a></div></li>';	 } // NO featured image + dateelse if ( !get_option( 'sel_thumb_amp' ) == '1' && get_option( 'sel_date_amp' ) == '1' ) {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="amplinkcont">'.get_the_title().'</a><p>'. $ampdate .'</p></div></li>';	} // NO featured image + NO dateelse if ( !get_option( 'sel_thumb_amp' ) == '1' && !get_option( 'sel_date_amp' ) == '1' ) {	 	echo '<li><a href="'. get_permalink() .''.$attappendamp.'/"><div class="amplinkcont">'.get_the_title().'</a></div></li>';	 	}		}	} else {	echo '<p>No recent posts found</p>';}	echo '</ul>';echo '</div>'; echo '</div>'; echo '</div>';    // Restore original Post Datawp_reset_postdata();	 }}       // Shortcode function amp_recent_function($atts, $append, $heading) { 	   extract(shortcode_atts(array(    	  'append' 	=> 'amp',	      'heading' => null,		  'max' 	=> 10,		  'cpt1' 	=> null,		  'cpt2' 	=> null,		  'cpt3' 	=> null,		  		  ), $atts));$return_string = '<ul>'; $args = array ( 	'post_type'              => array( 'post' ),	'post_status'            => 'publish',	'order'                  => 'DESC',	'orderby'                => 'date',	'showposts' 			 => $max,	'post__not_in'			 => array (get_the_ID()),	'heading'				 => $heading,	'append'			     => $append,);echo '<div class="jd-css-plugins-rec-short">';echo '<h3>'.$heading.'</h3>';echo '<ul>';// The Query$query = new WP_Query( $args );// The Loopif ( $query->have_posts() ) {	while ( $query->have_posts() ) {		$query->the_post();		// do something		echo '<li><a href="'.get_permalink().''.$append.'/">'.get_the_title().'</a></li>';	}} else {	// no posts found}echo '<ul>';echo '</div>';   // Restore original Post Datawp_reset_postdata();	 }  function register_shortcode_amp_rec(){	   add_shortcode('amp-recent-posts', 'amp_recent_function');}add_action( 'init', 'register_shortcode_amp_rec');    //*  AMP Plugin extra stylesadd_action( 'amp_post_template_css', 'jd_css_plugins_arp' );function jd_css_plugins_arp( $amp_template ) {	if ( function_exists('is_amp_endpoint') )    // only CSS here please...    ?>div.jd-css-plugins-cont {    max-width: 841px;    width: 100%;    margin: auto;}div.jd-css-plugins-inner {    padding: 35px 16px;}div.jd-css-plugins-arp li {    margin-bottom: initial;    margin-left: 20px;}div.amplinkcont {    line-height: 1.6;}div.amplinkcont {   padding-right: 16px;}div.amplinkcont p {    font-size: 87%;    opacity: .7;    line-height: 1.4;}div.jd-css-plugins-rec-short {  padding: 16px 16px 35px 16px;}div.jd-css-plugins-rec-short li {    margin-bottom: initial;    margin-left: 20px;}	<?php }   //*  AMP Plugin extra styles priorityadd_action( 'amp_post_template_css', 'jd_css_plugins_arp_prio' );function jd_css_plugins_arp_prio( $amp_template ) {	 if ( function_exists('is_amp_endpoint') && get_option( 'sel_thumb_amp' ) == '1' ) {    // only CSS here please...    ?> div.jd-css-plugins-arp li {    margin-bottom: initial;    margin-left: 0px;    list-style-type: none;}div.amplinkcont {    margin-left: 2px;    position: absolute;    display: inline-block;}div.ampimgcont {    height: 70px;    width: 70px;    padding: 2px;    border: 1px solid #ddd;    margin: 0px 10px 16px 0px;    display: inline-block;}	<?php }}    